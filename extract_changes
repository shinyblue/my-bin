#!/bin/bash
if [ ! -e thanbeforechanges ] 
then
	echo "reference file thanbeforechanges is missing"
	exit 1
fi
if [ -e changed ]
then
	echo "\`\`changed'' directory already exists"
	exit 1
fi
mkdir changed
cd changed
find ../. -newer ../thanbeforechanges -type f | grep -v "^.././changed" | grep -v "^../.$" >tocopy
if [ -s tocopy ] 
then
	if tar -c -T tocopy 2>/dev/null | tar -x 
	then :
	else
		echo some problem occured.
		exit 1
	fi
	# remove changes from original place
	while read file ; do rm -f "$file" ; done <tocopy
	rm -f tocopy
	cd ..
	ls * -d -1 | grep -v "^changed" >tocopy
	tar -czf unchanged.tgz -T tocopy || { echo "something went wrong creating unchanged.tgz" >&2 ; exit ; }
	while read file ; do rm -fr "$file" ; done <tocopy
	rm -f tocopy
	
else
	rm -f tocopy
	cd ..
	rmdir changed
	echo "No files changed newer thanbeforechanges" >&2
	exit 1
fi
